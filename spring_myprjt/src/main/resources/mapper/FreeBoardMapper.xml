<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="FreeBoardMapper">

	<insert id="insertBoard" parameterType="freeBoardVo">
		insert into free_board 
		(board_idx, all_board_number, title, content, member_idx, member_nickname 
   		<if test="originFile != null">
     		, originfile
  		 </if>
   		<if test="saveFile != null">
  		   , savefile
   		</if>
		)
		values(free_board_seq.nextval, all_board_seq.nextval, #{title}, #{content}, #{member_idx}, #{member_nickname} 
    	<if test="originFile != null">
   	   		, #{originFile}
    	</if>
    	<if test="saveFile != null">
      		, #{saveFile}
    	</if>
		)						
	</insert>

	<select id="selectCount" parameterType="map" resultType="_int">
		select count(*) from free_board
			<if test="searchWord != null">
				<where>
					<choose>
						<when test="searchField == 'title'">
							title like '%'||#{searchWord}||'%'
						</when>
						<when test="searchField == 'content'">
							content like '%'||#{searchWord}||'%'
						</when>
						<when test="searchField == 'nickname'">
							member_nickname like '%'||#{searchWord}||'%'
						</when>						
						<otherwise>
							board_idx in(select board_idx
											from free_board_reply
											where content like '%'||#{searchWord}||'%')
						</otherwise>
					</choose>
				</where>
			</if>
	</select>
	
	<select id="selectList" parameterType="map" resultType="freeBoardVo">
		select * from free_board
			<if test="searchWord != null">
				<where>
					<choose>
						<when test="searchField == 'title'">
							title like '%'||#{searchWord}||'%'
						</when>
						<when test="searchField == 'content'">
							content like '%'||#{searchWord}||'%'
						</when>
						<when test="searchField == 'nickname'">
							member_nickname like '%'||#{searchWord}||'%'
						</when>						
						<otherwise>
							board_idx in(select board_idx
											from free_board_reply
											where content like '%'||#{searchWord}||'%')
						</otherwise>
					</choose>
				</where>
			</if>
			order by board_idx desc
	</select>	
	
	<update id="updateReadCount" parameterType="_int">
		update free_board 
			set read_count = read_count+1 
			where board_idx = #{board_idx}
	</update>	
	
	<select id="selectView" parameterType="_int" resultType="freeBoardVo">
		select * from free_board where board_idx = #{board_idx}
	</select>	
	
	<update id="updateBoard" parameterType="freeBoardVo">
		update free_board
			<set>
				<if test="title != null">
					title = #{title},
				</if>
				<if test="content != null">
					content = #{content},
				</if>
				<if test="originFile != null">
					originfile = #{originFile},
				</if>
				<if test="saveFile != null">
					savefile = #{saveFile},
				</if> 
			</set>
				where board_idx = #{board_idx}
	</update>
	
	<delete id="deletePost" parameterType="_int">
		delete from free_board where board_idx = #{board_idx}
	</delete>		
	
	<select id="recommendationCount" parameterType="map" resultType="_int">
		select count(*) from FREE_BOARD_RECOMMENDATION 
		where member_idx = #{member_idx} and board_idx=#{board_idx}
	</select>		
	 
	<insert id="insertRecommendationCount" parameterType="map">
		insert into free_board_recommendation 
		(recommendation_idx, board_idx, member_idx)
		values(free_board_rd_seq.nextval, #{board_idx}, #{member_idx})						
	</insert>	
	
	<update id="updateRecommendationCount" parameterType="_int">
		update free_board
			set RECOMMENDATION_COUNT = RECOMMENDATION_COUNT+1
			where board_idx = #{board_idx}
	</update>	

	<update id="updateNotRecommendationCount" parameterType="_int">
		update free_board
			set NOT_RECOMMENDATION_COUNT = NOT_RECOMMENDATION_COUNT+1
			where board_idx = #{board_idx}
	</update>
	
	<delete id="deleteRecommendation" parameterType="_int">
		delete from free_board_recommendation where board_idx = #{board_idx}
	</delete>			
</mapper>